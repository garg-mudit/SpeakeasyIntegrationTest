# File: generate-sdk-template.yml
parameters:
- name: language
  type: string
- name: generateSDK
  type: boolean
  default: false

jobs:
- job: Generate_${{ parameters.language }}
  condition: eq('${{ parameters.generateSDK }}', 'true')
  steps:
  - template: install-speakeasy-cli.yml
  - template: clone-repo.yml
    parameters:
      repoUrl: "docuTest-${{parameters.language}}-sdk-private"
      targetDirectory: "private-sdks/docuTest-${{parameters.language}}-sdk-private"
  - script: |
      cd "docusign-test-js-sdk"
      speakeasy run
    displayName: 'Generate ${{ parameters.language }} SDK'

  - script: |
      cd docusign-test-js-sdk

      git config user.name "automation-bot"
      # this is test email, replace with actual email
      git config user.email "mudit.garg@docusign.com"

      git checkout -b sdk-update-${{ parameters.language }}-$(Build.BuildId)

      git add .
      git commit -m "chore: regenerate ${{ parameters.language }} SDK via Speakeasy"
      git push origin HEAD
    displayName: 'Commit and Push SDK Changes'

  - script: |
      cd docusign-test-js-sdk
      echo "$(GITHUB_PAT)" | gh auth login --with-token
      gh pr create \
      --title "Update ${{ parameters.language }} SDK" \
      --body "Automated PR with regenerated SDK" \
      --base main \
      --head sdk-update-${{ parameters.language }}-$(Build.BuildId)
    displayName: 'Create Pull Request on GitHub'
# - publish: ./sdks/${{ parameters.language }}