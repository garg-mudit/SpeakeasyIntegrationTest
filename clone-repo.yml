# File: clone-repo.yml

parameters:
  - name: orgName
    type: string
  - name: repoName
    type: string
  - name: targetDirectory
    type: string

steps:
  - script: |

      # Exit the script immediately if any command fails (non-zero exit code).
      # This prevents the script from continuing in a broken state.
      set -e

      # Set up a trap to catch termination signals (SIGINT from Ctrl+C or SIGTERM from pipeline cancel).
      # When caught, print a message and exit with status 1.
      # This ensures the script exits gracefully instead of silently failing or hanging.
      trap "echo 'ðŸ›‘ Cancelled or interrupted. Exiting...'; exit 1" SIGINT SIGTERM

      echo "Cloning github.com/${{ parameters.orgName }}/${{ parameters.repoName }} into ${{ parameters.targetDirectory }}"
      echo "git clone --progress --verbose \"https://$(GITHUB_PAT)@github.com/${{ parameters.orgName }}/${{ parameters.repoName }}.git\" \"${{ parameters.targetDirectory }}\""
      git clone --progress --verbose "https://$(GITHUB_PAT)@github.com/${{ parameters.orgName }}/${{ parameters.repoName }}.git" "${{ parameters.targetDirectory }}"
    displayName: "Clone ${{ parameters.orgName }}/${{ parameters.repoName }} Repo"